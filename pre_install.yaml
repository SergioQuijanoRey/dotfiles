# Script to run all pre-install tasks

Install yay:
  description: Install yay from sources
  quiet: false
  commands:
    - cd ~
    - mkdir tmp_install_yay ; cd tmp_install_yay
    - git clone https://aur.archlinux.org/yay.git
    - cd yay
    - makepkg -si
    - cd ~ ; rm -rf tmp_install_yay

Install nix package manager:
  description: Installs nix package manager, that we are going to use to install many packages
               using home manager
  quiet: false
  commands:
    - sh <(curl -L https://nixos.org/nix/install) --daemon

Install home manager:
  description: Install home manager to have more options using nix package manager
  quiet: false
  commands:
    # Add the home manager channel
    - nix-channel --add https://github.com/nix-community/home-manager/archive/master.tar.gz home-manager
    - nix-channel --update

    # Run the installation
    - export NIX_PATH=$HOME/.nix-defexpr/channels:/nix/var/nix/profiles/per-user/root/channels${NIX_PATH:+:$NIX_PATH}
    - nix-shell '<home-manager>' -A install

Add nixpkgs channels:
  description: Adds the paths to the nix channels I am using
  quiet: false
  commands:
    - nix-channel --add https://github.com/guibou/nixGL/archive/main.tar.gz nixgl
    - nix-channel --update
